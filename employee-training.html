<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Training Record Form</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="employee-training.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Navigation sidebar will be injected here -->
        <div id="nav-placeholder"></div>

        <!-- Main Content -->
        <div id="main-content">
            <div class="header-curve"></div>
            <h1 class="page-title">Employee Training Record Form</h1>
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Training Title</label>
                        <div class="input-with-icon training-selection-container">
                            <div class="custom-select">
                                <div class="select-selected" id="trainingDropdown">
                                    <span>Select Training Titles</span>
                                    <i class="fas fa-chevron-down dropdown-icon"></i>
                                </div>
                                <div class="select-items select-hide">
                                    <div class="select-item" data-value="1">
                                        <input type="checkbox" id="training1">
                                        <label for="training1">SOP for analyst qualification</label>
                                    </div>
                                    <div class="select-item" data-value="2">
                                        <input type="checkbox" id="training2">
                                        <label for="training2">Quality Control Procedures</label>
                                    </div>
                                    <div class="select-item" data-value="3">
                                        <input type="checkbox" id="training3">
                                        <label for="training3">Laboratory Safety Guidelines</label>
                                    </div>
                                    <div class="select-item" data-value="4">
                                        <input type="checkbox" id="training4">
                                        <label for="training4">Equipment Calibration Protocol</label>
                                    </div>
                                    <div class="select-item" data-value="5">
                                        <input type="checkbox" id="training5">
                                        <label for="training5">Data Analysis Methods</label>
                                    </div>
                                </div>
                            </div>
                            <div id="selectedTrainings" class="selected-trainings"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Employees</label>
                        <div class="input-with-icon employee-selection-container">
                            <div class="custom-select">
                                <div class="select-selected" id="employeeDropdown">
                                    <span>Select Employees</span>
                                    <i class="fas fa-chevron-down dropdown-icon"></i>
                                </div>
                                <div class="select-items select-hide">
                                    <div class="select-item" data-value="1">
                                        <input type="checkbox" id="emp1">
                                        <label for="emp1">Shubham Kumar</label>
                                    </div>
                                    <div class="select-item" data-value="2">
                                        <input type="checkbox" id="emp2">
                                        <label for="emp2">Rahul Kumar</label>
                                    </div>
                                    <div class="select-item" data-value="3">
                                        <input type="checkbox" id="emp3">
                                        <label for="emp3">Ritik Jain</label>
                                    </div>
                                    <div class="select-item" data-value="4">
                                        <input type="checkbox" id="emp4">
                                        <label for="emp4">Shivam Tyagi</label>
                                    </div>
                                </div>
                            </div>
                            <div id="selectedEmployees" class="selected-employees"></div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Prepared By</label>
                        <div class="input-with-icon">
                            <select class="form-control" id="preparedBySelect">
                                <option value="Pawan Pal">Pawan Pal</option>
                                <option value="Sahil Bhushan">Sahil Bhushan</option>
                                <option value="Rajesh Singhal">Rajesh Singhal</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" style="visibility: hidden;">
                        <!-- Empty slot to maintain grid layout -->
                    </div>
                </div>
                <div style="text-align: left; margin-top: 20px;">
                    <button id="saveButton" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
    // Employees Selection
    const employeeDropdown = document.getElementById('employeeDropdown');
    const employeeSelectItems = document.querySelector('.employee-selection-container .select-items');
    const selectedEmployeesDiv = document.getElementById('selectedEmployees');
    let selectedEmployees = new Set();

    // Training Title Selection
    const trainingDropdown = document.getElementById('trainingDropdown');
    const trainingSelectItems = document.querySelector('.training-selection-container .select-items');
    const selectedTrainingsDiv = document.getElementById('selectedTrainings');
    let selectedTrainings = new Set();

    function setupDropdown(dropdown, selectItems, selectedDiv, selectedSet, storageKey, labelText) {
        // Toggle dropdown
        dropdown.addEventListener('click', function (e) {
            e.stopPropagation();
            selectItems.classList.toggle('select-hide');
            dropdown.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function () {
            selectItems.classList.add('select-hide');
            dropdown.classList.remove('active');
        });

        // Prevent dropdown from closing when clicking inside
        selectItems.addEventListener('click', function (e) {
            e.stopPropagation();
        });

        // Handle checkbox selection
        const checkboxes = selectItems.querySelectorAll('.select-item input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function () {
                const item = this.closest('.select-item');
                const value = item.getAttribute('data-value');
                const label = item.querySelector('label').textContent;

                if (this.checked) {
                    selectedSet.add({ value, label });
                } else {
                    selectedSet.forEach(entry => {
                        if (entry.value === value) {
                            selectedSet.delete(entry);
                        }
                    });
                }
                updateSelectedItems();
            });
        });

        function updateSelectedItems() {
            selectedDiv.innerHTML = '';
            selectedSet.forEach(entry => {
                const tag = document.createElement('span');
                tag.className = 'selected-item';
                tag.innerHTML = `${entry.label} <span class="remove-item" data-value="${entry.value}">&times;</span>`;
                selectedDiv.appendChild(tag);

                // Remove functionality
                tag.querySelector('.remove-item').addEventListener('click', function () {
                    const value = this.getAttribute('data-value');
                    const checkbox = selectItems.querySelector(`.select-item[data-value="${value}"] input`);
                    checkbox.checked = false;
                    selectedSet.forEach(entry => {
                        if (entry.value === value) {
                            selectedSet.delete(entry);
                        }
                    });
                    updateSelectedItems();
                });
            });

            // Update dropdown text
            const dropdownText = dropdown.querySelector('span');
            if (selectedSet.size === 0) {
                dropdownText.textContent = labelText;
            } else {
                dropdownText.textContent = `${selectedSet.size} Selected`;
            }
        }
    }

    // Setup dropdowns for Training Title and Employees
    setupDropdown(employeeDropdown, employeeSelectItems, selectedEmployeesDiv, selectedEmployees, 'selectedEmployees', 'Select Employees');
    setupDropdown(trainingDropdown, trainingSelectItems, selectedTrainingsDiv, selectedTrainings, 'selected-Trainings', 'Select Trainings');

    // Save button functionality
    const saveButton = document.getElementById('saveButton');
    saveButton.addEventListener('click', function () {
        if (selectedEmployees.size === 0 || selectedTrainings.size === 0) {
            alert('Please select at least one Employee and one Training Title.');
            return;
        }

        // Get all selected employees and trainings
        const selectedEmployeesList = Array.from(selectedEmployees);
        const selectedTrainingsList = Array.from(selectedTrainings);
        const preparedBy = document.getElementById('preparedBySelect').value;

        // Create planner entries for each employee
        const plannerEntries = [];
        selectedEmployeesList.forEach(employee => {
            const plannerEntry = {
                trainingType: 'Employee Training',
                plannerType: selectedTrainingsList.map(item => item.label).join(', '),
                employees: employee.label, // Single employee name
                department: 'QA',
                subDepartment: '-NA-',
                year: new Date().getFullYear().toString(),
                preparedBy: preparedBy,
                employeesList: [employee], // Single employee object
                trainingList: selectedTrainingsList
            };
            plannerEntries.push(plannerEntry);
        });

        // Get existing entries from localStorage
        let existingEntries = JSON.parse(localStorage.getItem('plannerEntries') || '[]');
        
        // Add new entries to existing ones
        existingEntries = existingEntries.concat(plannerEntries);
        
        // Save back to localStorage
        localStorage.setItem('plannerEntries', JSON.stringify(existingEntries));

        // Redirect to planner page
        window.location.href = 'planner.html';
    });
});

    </script>
</body>
</html>